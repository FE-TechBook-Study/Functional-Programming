# 상현
## 18. 반응형 아키텍처와 어니언 아키텍처

목표

- 반응형 아키텍처로 순차적 액션을 파이프라인으로 만드는 방법 학습
- 상태 변경을 다루기 위한 기본형 만들기
- 도메인과 현실 세계의 상호작용을 위해 어니언 아키텍처 만들기
- 여러 계층에 어니언 아키텍처를 적용하는 방법 알아보기
- 전통적인 계층형 아키텍처와 어니텅 아키텍처를 비교해 보기

### 반응형 아키텍처

코드에 나타난 순차적 액션을 표시

핵심원칙은 이벤트에 대한 반응으로 일어날 일을 지정하는 것

웹 서비스와 UI에 잘 어울림

코드에 3가지 중요한 영향을 줌

1. 원인과 효과가 결합된 것을 분리
    
    ![image](https://kooku0.github.io/assets/images/18.2-885cd79476a72d073bdb922c00fb2fc9.jpg)
    
    - 다수의 이벤트에 대한 콜백으로 전부 하나씩 추가해주는 것이 있다면 콜백을 분리하여 다수의 이벤트가 일어나면 실행될 수 있게 반응형을 추가
    - 그러나 문제가 없는데 분리하는 것은 오히려 이해하기 어려운 구조로 갈 수 있다. 이 책에서 나오는 장바구니처럼 원인과 효과의 중심이 없다면 분리하지 않기
2. 여러 단계를 파이프라인으로 처리
    - 여러 개의 계산을 연결하여 처리
3. 타임라인이 유연해짐
    
    ![타임라인 유연](https://kooku0.github.io/assets/images/18.5-56c4e2d6e39951dba512109f657a35f8.jpg)
    
    - 순서를 정의하는 방법을 뒤집기 때문에 자연스럽게 타임라인이 적은 부분으로 분리
    - 타임라인이 많아지면 문제지만, 공유하는 자원이 없으면 문제 없음

### 어니언 아키텍처(Onion Architecture)

![어니언 아키텍처](https://kooku0.github.io/assets/images/18.7-55b0600f9c5d5e56ef68f4a1b83a6408.jpg)

반응형보다는 더 넓은 범위에서 사용. 서비스 전체를 구성하는데 사용되기 때문에 바깥 세계와 상호작용을 하는 부분을 다룸

반응형과 같이 사용할 수 있지만 반응형이 어니언 내부에 포함되어 있는 형태를 가지며 서로 의존하지 않음

액션에서 계산을 빼내면 의도하지 않아도 어니언 아키텍처 구조 성립

3가지 층

- 인터렉션 계층: 바깥세상에 영향을 주거나 받는 액션
- 도메인 계층: 비즈니스 규칙을 정의하는 계산
- 언어 계층: 언어 유틸리티와 라이브러리

3가지 규칙

- 현실 세계와 상호작용은 인터렉션 계층에서만 작용
- 계층에서 호출하는 방향은 중심 방향
- 계층은 외부에 어떤 계층이 있는지 모름

외부 서비스를 바꾸기 쉽다 = 변경성, 좋은 인프라보다 좋은 도메인이 중요

**프로그램의 핵심 로직을 도메인 규칙(domain rule) 또는 비즈니스 규칙(business rule)**

- 모든 로직은 도메인 로직(비즈니스 로직)이 아니다. 도메인 로직은 도메인 관련 용어를 사용한다
    - 규칙에는 제품, 이미지, 가격 등의 용어가 사용

## 19. 함수형 프로그래밍 여행에 앞서

### 꼭 기억해야 하는 것

어떤 경우에는 액션에 계산이 숨어 있습니다.

- 계산을 빼는 것은 귀찮지만 재사용성, 테스트 용이성, 가독성을 위해 가치 있는 일
- 넓은 관점에서 보면 결국 어니언 아키텍처로 구상

고참 함수를 사용하면 추상화에 대한 개념이 넓어집니다.

- 고차함수를 사용하면 저수준의 코드를 반복적 작성 방지. 이로 인해 도메인에 집중 가능

코드에서 시간의 의미는 마음대로 바꿀 수 있습니다.

- 코드가 실행되는 순서를 이해하는 것이 중요
- 타임라인 다이어그램으로 시간의 흐름에 따라 코드실행 시각화 가능

### 기술을 배우고 사용하는 방법(혼자 짜집기한 부제)

투 트랙

1. 샌드박스: 연습하는 공간
    1. 연습 문제, 사이드 프로젝트, 제품 코드에서 버려진 branch
2. 제품: 기술이 익숙해진 것 같다는 생각이 든다면 적용해보기
    1. 코드 리팩터링, 신규 기능, 리뉴얼, 멘토링

수학적 지식 얻기

- 람다 대수, 콤비네티어, 타입 이론, 카테고리 이론, 이펙트 시스템(모나드 ,어플리커티브 펑터)